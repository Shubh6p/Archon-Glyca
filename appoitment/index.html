<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Your Session | ARCHON GLYCA Fitness Coaching</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="../assets/favicon.ico" type="image/x-icon">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { accent: '#D4FF00', surface: '#050505', card: '#0F0F0F' },
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'], display: ['Space Grotesk', 'sans-serif'] },
                }
            }
        }
    </script>

    <style>
        /* ============= CORE LAYOUT & ACCESSIBILITY ============= */
        body { 
            background-color: #050505; 
            color: white; 
            -webkit-font-smoothing: antialiased; 
            overflow-x: hidden; 
        }

        .preload * {
            transition: none !important;
        }

        /* ============= ENHANCED PRO REVEAL SYSTEM ============= */
        .reveal { 
            opacity: 0; 
            transform: translateY(60px); 
            transition: all 1.4s cubic-bezier(0.16, 1, 0.3, 1); 
            will-change: transform, opacity; 
        }

        .reveal.active { 
            opacity: 1; 
            transform: translateY(0); 
        }

        /* Staggered Delay Logic */
        .delay-100 { transition-delay: 150ms; }
        .delay-200 { transition-delay: 300ms; }
        .delay-300 { transition-delay: 450ms; }

        /* ============= DYNAMIC NAV & SCROLL PROGRESS ============= */
        .nav-scrolled { 
            background: rgba(5, 5, 5, 0.95) !important; 
            backdrop-filter: blur(50px); 
            border-bottom: 1px solid rgba(212, 255, 0, 0.1); 
            padding: 1rem 2rem !important;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
        }

        #navbar {
            transition: all 0.7s cubic-bezier(0.16, 1, 0.3, 1);
        }

        /* ============= MODERN HAMBURGER & MOBILE MENU ============= */
        .hamburger {
            width: 28px;
            height: 20px;
            position: relative;
            cursor: pointer;
        }

        .hamburger span {
            display: block;
            position: absolute;
            height: 2px;
            width: 100%;
            background: #D4FF00;
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .hamburger span:nth-child(1) { top: 0; }
        .hamburger span:nth-child(2) { top: 9px; }
        .hamburger span:nth-child(3) { top: 18px; }

        .hamburger.active span:nth-child(1) {
            top: 9px;
            transform: rotate(135deg);
        }

        .hamburger.active span:nth-child(2) {
            opacity: 0;
            left: -60px;
        }

        .hamburger.active span:nth-child(3) {
            top: 9px;
            transform: rotate(-135deg);
        }

        .mobile-menu {
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .mobile-menu.active {
            transform: translateX(0);
        }

        /* ============= FORM COMPONENTS & GLASS UI ============= */
        .glass-card { 
            background: rgba(15, 15, 15, 0.4); 
            backdrop-filter: blur(20px); 
            border: 1px solid rgba(255,255,255,0.03); 
            transition: all 0.8s cubic-bezier(0.19, 1, 0.22, 1); 
        }

        .form-input { 
            transition: all 0.3s ease; 
            background: rgba(15, 15, 15, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .form-input:focus { 
            border-color: #D4FF00; 
            background: rgba(212, 255, 0, 0.05); 
            box-shadow: 0 0 20px rgba(212, 255, 0, 0.2);
            outline: none;
        }

        /* Date Picker & Select Enhancements */
        input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); cursor: pointer; }
        
        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23D4FF00'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1.5em;
        }

        select option {
            background-color: #0F0F0F; 
            color: #FFFFFF; 
            padding: 10px;
        }

        select[name="appointmentRegarding"] option {
            color: #D4FF00; 
        }

        /* ============= UTILITIES & UI COMPONENTS ============= */
        /* Dropdown Animation */
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slideDown { animation: slideDown 0.3s ease-out forwards; }

        /* Ripple Effect */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            transform: scale(0);
            animation: ripple-effect 0.6s ease-out;
        }
        @keyframes ripple-effect { to { transform: scale(4); opacity: 0; } }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: rgba(212, 255, 0, 0.3); border-radius: 4px; }

        @media (max-width: 640px) {
            .nav-scrolled { padding: 0.5rem 1rem !important; }
        }
    </style>
</head>
<body class="bg-surface text-white selection:bg-accent selection:text-black preload">

    <!-- Loader -->
    <div id="loader" class="fixed inset-0 z-[200] bg-surface flex items-center justify-center transition-opacity duration-700">
        <div class="flex flex-col items-center">
            <div class="w-16 h-16 border-2 border-accent/20 border-t-accent rounded-full animate-spin"></div>
            <p class="mt-6 font-display tracking-[0.8em] text-[10px] font-bold text-accent animate-pulse uppercase">LOADING APPOINTMENT FORM</p>
        </div>
    </div>

    <!-- ============= NAVBAR ============= -->
    <nav id="navbar" class="fixed top-0 w-full z-[100] transition-all duration-700 px-4 sm:px-8 py-4 sm:py-8 flex justify-between items-center bg-surface/80 backdrop-blur-xl border-b border-white/5">
    
        <div class="lg:hidden hamburger" id="hamburger" onclick="toggleMobileMenu()" role="button" aria-label="Toggle menu">
            <span></span><span></span><span></span>
        </div>

        <div class="hidden lg:flex items-center gap-3 group cursor-pointer" onclick="window.location.href='/home'">
            <div class="w-8 sm:w-10 h-[2px] bg-accent transition-all group-hover:w-12 sm:group-hover:w-16"></div>
            <a href="/home" class="font-display font-bold text-xl sm:text-2xl tracking-tighter italic text-accent uppercase">
                ARCHON <span class="text-white">GLYCA</span>
            </a>
        </div>

        <div class="lg:hidden absolute left-1/2 -translate-x-1/2">
            <a href="/home" class="font-display font-bold text-lg sm:text-xl tracking-tighter italic text-accent uppercase">
                ARCHON <span class="text-white">GLYCA</span>
            </a>
        </div>

        <div class="hidden lg:flex items-center gap-6 xl:gap-10">
            <div class="flex gap-6 xl:gap-8 text-[9px] sm:text-[10px] font-bold uppercase tracking-[0.4em] text-white/50">
                <a href="/home" class="hover:text-accent transition-all relative group">Home</a>
                <a href="/about-coach" class="hover:text-accent transition-all relative group">About Coach</a>
                <a href="/programs/" class="hover:text-accent transition-all relative group">Programs</a>
                <a href="/home/#advice" class="hover:text-accent transition-all relative group">Tips & Advice</a>
                <a href="/contact-us" class="hover:text-accent transition-all relative group">Contact Us</a>
                <a href="/about-us" class="hover:text-accent transition-all relative group">About Us</a>
            </div>
            <div id="nav-auth-section" class="flex items-center gap-4 border-l border-white/10 pl-6 xl:pl-10 relative group">
                </div>
        </div>
        
        <div class="lg:hidden relative" id="mobile-profile-container">
            <button id="profile-icon-btn" class="w-10 h-10 rounded-full border border-accent/30 flex items-center justify-center bg-accent/5 text-accent outline-none">
                <i class="fas fa-user-circle text-xl"></i>
            </button>
            <div id="profile-dropdown" class="hidden absolute top-full right-0 mt-3 w-48 bg-card border border-white/10 rounded-2xl shadow-2xl overflow-hidden animate-slideDown z-[120]">
                <div id="mobile-profile-options"></div>
            </div>
        </div>
    </nav>

    <div id="mobileMenu" class="fixed top-0 left-0 w-[80%] h-screen bg-surface border-r border-white/5 z-[110] transition-transform duration-500 -translate-x-full lg:hidden">
        <div class="p-8 space-y-8 h-full flex flex-col overflow-y-auto">
            <div class="flex items-center gap-3 mb-10">
                <div class="w-10 h-10 bg-accent rounded-xl flex items-center justify-center"><i class="fas fa-bolt text-black text-sm"></i></div>
                <a class="font-display font-bold text-xl tracking-tighter italic text-accent uppercase">
                    ARCHON <span class="text-white">GLYCA</span>
                </a>  
            </div>
            <div class="flex flex-col gap-2">
                <a href="/home" class="p-4 text-lg font-bold uppercase tracking-widest text-white/60 hover:text-accent">Home</a>
                <a href="/about-coach" class="p-4 text-lg font-bold uppercase tracking-widest text-white/60 hover:text-accent">About Coach</a>
                <a href="/programs/" class="p-4 text-lg font-bold uppercase tracking-widest text-white/60 hover:text-accent">Programs</a>
                <a href="/home/#stories" class="p-4 text-lg font-bold uppercase tracking-widest text-white/60 hover:text-accent">Tips & Advices</a>
                <a href="/contact-us" class="p-4 text-lg font-bold uppercase tracking-widest text-white/60 hover:text-accent">Contact Us</a>
                <a href="/about-us" class="p-4 text-lg font-bold uppercase tracking-widest text-white/60 hover:text-accent">About Us</a>
            </div>
            <div id="sidebar-auth-section" class="mt-auto pb-10"></div>
        </div>
    </div>
    <div id="menuBackdrop" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[105] hidden lg:hidden" onclick="toggleMobileMenu()"></div>
    <br><br><br>
    
    <main class="max-w-4xl mx-auto">
        <header class="mb-12">
            <a href="/home" class="text-[10px] font-bold text-accent uppercase tracking-[0.4em] mb-8 inline-block hover:tracking-[0.5em] transition-all">
                <i class="fas fa-arrow-left mr-2"></i> Return to Home
            </a>
            <h1 class="text-5xl md:text-7xl font-display font-bold italic tracking-tighter uppercase leading-none">
                START YOUR <br> <span class="text-accent not-italic">TRANSFORMATION</span>
            </h1>
            <p class="text-white/30 text-[10px] uppercase tracking-[0.3em] italic mt-4">Secure your personal coaching window</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
            <div class="lg:col-span-4 space-y-8">
                <div class="p-8 border border-accent/10 rounded-[2.5rem] bg-accent/5">
                    <h2 class="text-accent text-[10px] font-bold uppercase tracking-widest mb-4">Studio Status</h2>
                    <p class="text-sm italic leading-relaxed text-white/60">
                        Welcome to <span class="text-white font-bold">Archon Glyca</span>. Our Lead Fitness Mentor is now available for new client sessions.
                    </p>
                </div>
                
                <div class="space-y-4">
                    <p class="text-xs uppercase tracking-widest text-white/20 font-bold">Training Requirements:</p>
                    <ul class="text-[10px] space-y-3 text-white/40 uppercase font-black tracking-widest">
                        <li class="flex items-center gap-2"><i class="fas fa-check text-accent"></i> Dedicated Commitment</li>
                        <li class="flex items-center gap-2"><i class="fas fa-check text-accent"></i> Real Result Tracking</li>
                        <li class="flex items-center gap-2"><i class="fas fa-check text-accent"></i> Personal Mentorship</li>
                    </ul>
                </div>

                <p class="text-[9px] text-accent/40 font-bold uppercase tracking-widest">Note: Personalized coaching sessions are part of our premium membership plans.</p>
            </div>

            <div class="lg:col-span-8">
                <form id="appointmentForm" class="glass-card p-10 rounded-[3rem] space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <input type="text" name="fullName" placeholder="Your Full Name" class="form-input w-full bg-white/5 p-4 rounded-xl border border-white/10 outline-none" required>
                        <input type="text" name="whatsappNumber" placeholder="WhatsApp Number" class="form-input w-full bg-white/5 p-4 rounded-xl border border-white/10 outline-none" required>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <select name="appointmentRegarding" class="form-input w-full bg-white/5 p-4 rounded-xl border border-white/10 text-accent font-bold outline-none cursor-pointer" required>
                            <option value="" disabled selected class="text-white/30">Select Your Goal...</option>
                            <option value="Zumba">Zumba</option>
                            <option value="Aerobics">Aerobics</option>
                            <option value="Yoga">Yoga</option>
                            <option value="HIIT Training">HIIT Training</option>
                            <option value="Kettlebell Workout">Kettlebell Workout</option>
                            <option value="Diabetes Management Training">Diabetes Management Training</option>
                            <option value="Pilates">Pilates</option>
                            <option value="Weight Training">Weight Training</option>
                        </select>
                        
                        <select name="preferredLanguage" class="form-input w-full bg-white/5 p-4 rounded-xl border border-white/10 text-white font-bold outline-none cursor-pointer" required>
                            <option value="" disabled selected class="text-white/30">Preferred Language</option>
                            <option value="Hindi">Hindi</option>
                            <option value="English">English</option>
                        </select>
                    </div>

                    <div class="space-y-2">
                        <label class="text-[10px] text-white/20 font-bold uppercase tracking-widest ml-2">Preferred Training Date</label>
                        <input type="date" name="date" id="bookDate" class="form-input w-full bg-white/5 p-4 rounded-xl border border-white/10 text-accent font-bold outline-none" required>
                    </div>

                    <button type="submit" class="w-full bg-accent text-black font-black py-6 rounded-full uppercase tracking-widest hover:shadow-[0_0_40px_rgba(212,255,0,0.4)] transition-all duration-500 transform hover:-translate-y-1">
                        Confirm My Training Slot
                    </button>
                </form>
            </div>
        </div>
    </main>

    <div id="customModal" class="fixed inset-0 z-[300] flex items-center justify-center p-6 opacity-0 pointer-events-none transition-all duration-500">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-xl"></div>
        <div id="modalCard" class="bg-card border border-white/10 w-full max-w-sm rounded-[2.5rem] p-10 relative z-10 text-center scale-90 transition-all duration-500 overflow-hidden">
            <div id="modalLoader" class="hidden mb-6">
                <div class="w-16 h-16 border-2 border-accent/20 border-t-accent rounded-full animate-spin mx-auto"></div>
            </div>
            <div id="modalIconContainer" class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-6 bg-accent/10 border border-accent/20">
                <i id="modalIcon" class="fas fa-check text-accent text-xl"></i>
            </div>
            <h3 id="modalTitle" class="text-2xl font-display font-bold italic uppercase tracking-tighter mb-2 text-white"></h3>
            <p id="modalBody" class="text-white/40 text-[10px] font-bold uppercase tracking-widest italic leading-relaxed mb-8"></p>
            <button id="modalActionButton" onclick="closeModal()" class="hidden w-full bg-accent text-black font-black py-4 rounded-full uppercase text-[10px] tracking-[0.2em] relative z-10 hover:shadow-[0_0_20px_rgba(212,255,0,0.4)]">
                Back to Home
            </button>
            <div id="progressBarContainer" class="absolute bottom-0 left-0 w-full h-1 bg-white/5">
                <div id="progressBar" class="h-full bg-accent transition-all duration-[3000ms] ease-linear w-full"></div>
            </div>
        </div>
    </div>

    <!-- ============= FOOTER ============= -->
    <footer class="bg-[#020202] pt-24 sm:pt-32 pb-8 sm:pb-12 px-4 sm:px-8 border-t border-white/5 relative overflow-hidden" role="contentinfo">
        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-px bg-gradient-to-r from-transparent via-accent/50 to-transparent"></div>

        <div class="max-w-[1400px] mx-auto">
            <div class="grid grid-cols-12 gap-6 sm:gap-12 mb-16 sm:mb-20">
                
                <div class="col-span-12 lg:col-span-4 space-y-6 sm:space-y-8">
                    <div class="flex items-center gap-3 group cursor-pointer" onclick="backToHome()">
                        <div class="w-10 sm:w-12 h-[2px] bg-accent transition-all group-hover:w-14 sm:group-hover:w-16"></div>
                        <span class="font-display font-bold text-2xl sm:text-3xl tracking-tighter italic text-accent uppercase">Archana<span class="text-white">Sah</span></span>
                    </div>
                    <p class="text-white/40 text-sm leading-relaxed italic max-w-sm">
                        Your online fitness platform helping people control diabetes, lose weight, and live healthier through home-based workouts and expert coaching.
                    </p>
                    <div class="flex items-center gap-3">
                        <span class="relative flex h-2 w-2">
                            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-accent opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-2 w-2 bg-accent"></span>
                        </span>
                        <span class="text-[9px] sm:text-[10px] font-bold uppercase tracking-[0.3em] text-accent/60 italic">We're Open: Accepting New Clients</span>
                    </div>
                </div>

                <div class="col-span-6 md:col-span-3 lg:col-span-2">
                    <h4 class="text-white font-bold text-[9px] sm:text-[10px] uppercase tracking-[0.4em] mb-6 sm:mb-8 italic">Quick Links</h4>
                    <ul class="space-y-3 sm:space-y-4 text-sm text-white/30 font-medium italic">
                        <li><a href="/about-coach" class="hover:text-accent transition-colors duration-300 flex items-center gap-2 group"><span class="w-0 group-hover:w-4 h-[1px] bg-accent transition-all"></span>Coach Profile</a></li>
                        <li><a href="/programs/" class="hover:text-accent transition-colors duration-300 flex items-center gap-2 group"><span class="w-0 group-hover:w-4 h-[1px] bg-accent transition-all"></span>Our Programs</a></li>
                        <li><a href="/home/#stories" class="hover:text-accent transition-colors duration-300 flex items-center gap-2 group"><span class="w-0 group-hover:w-4 h-[1px] bg-accent transition-all"></span>Members Stories</a></li>
                        <li><a href="/home/#advice" class="hover:text-accent transition-colors duration-300 flex items-center gap-2 group"><span class="w-0 group-hover:w-4 h-[1px] bg-accent transition-all"></span>Tips & Advice</a></li>
                    </ul>
                </div>

                <div class="col-span-6 md:col-span-3 lg:col-span-2">
                    <h4 class="text-white font-bold text-[9px] sm:text-[10px] uppercase tracking-[0.4em] mb-6 sm:mb-8 italic">Legal</h4>
                    <ul class="space-y-3 sm:space-y-4 text-sm text-white/30 font-medium italic">
                        <li><a href="/privacy-policy" class="hover:text-accent transition-colors duration-300 flex items-center gap-2 group"><span class="w-0 group-hover:w-4 h-[1px] bg-accent transition-all"></span>Privacy Policy</a></li>
                        <li><a href="/terms-and-conditions" class="hover:text-accent transition-colors duration-300 flex items-center gap-2 group"><span class="w-0 group-hover:w-4 h-[1px] bg-accent transition-all"></span>Terms of Service</a></li>
                        <li><a href="/refund-policy" class="hover:text-accent transition-colors duration-300 flex items-center gap-2 group"><span class="w-0 group-hover:w-4 h-[1px] bg-accent transition-all"></span>Refund Policy</a></li>
                    </ul>
                </div>

                <div class="col-span-12 lg:col-span-4 flex flex-col items-center lg:items-start text-center lg:text-left">
                    <h4 class="text-white font-bold text-[9px] sm:text-[10px] uppercase tracking-[0.4em] mb-6 sm:mb-8 italic">Connect With Us</h4>
                    
                    <div class="flex justify-center lg:justify-start gap-3 sm:gap-4 mb-6 sm:mb-8">
                        <a href="https://www.facebook.com/archana.sah.524" class="w-10 sm:w-12 h-10 sm:h-12 bg-white/5 rounded-full flex items-center justify-center hover:bg-accent hover:text-black transition-all" aria-label="Facebook">
                            <i class="fab fa-facebook-f" aria-hidden="true"></i>
                        </a>
                        <a href="https://www.instagram.com/archusah9" class="w-10 sm:w-12 h-10 sm:h-12 bg-white/5 rounded-full flex items-center justify-center hover:bg-accent hover:text-black transition-all" aria-label="Instagram">
                            <i class="fab fa-instagram" aria-hidden="true"></i>
                        </a>
                        <a href="https://www.youtube.com/@fitwitharchu" class="w-10 sm:w-12 h-10 sm:h-12 bg-white/5 rounded-full flex items-center justify-center hover:bg-accent hover:text-black transition-all" aria-label="YouTube">
                            <i class="fab fa-youtube" aria-hidden="true"></i>
                        </a>
                        <a href="https://in.linkedin.com/in/archana-kumari-sah-b6b8a3165" class="w-10 sm:w-12 h-10 sm:h-12 bg-white/5 rounded-full flex items-center justify-center hover:bg-accent hover:text-black transition-all" aria-label="LinkedIn">
                            <i class="fab fa-linkedin-in" aria-hidden="true"></i>
                        </a>
                    </div>

                    <p class="text-[9px] sm:text-[10px] text-white/20 uppercase tracking-widest font-bold italic">Contact: info@archonglyca.com</p>
                </div>
            </div>

            <div class="border-t border-white/5 pt-8 sm:pt-12 flex flex-col md:flex-row justify-between items-center gap-4 sm:gap-6">
                <p class="text-[9px] sm:text-[10px] text-white/20 uppercase tracking-widest font-bold italic">Â© 2025 ARCHON GLYCA. All Rights Reserved.</p>
                <p class="text-[9px] sm:text-[10px] text-white/10 italic">Helping you get fit and healthy from home</p>
            </div>
        </div>
    </footer>


    <script>
        const API_URL = "https://archon-glyca-backend.vercel.app";
        let modalTimer;

        // ============= 01: INITIALIZATION & AUTH =============
        window.addEventListener('load', () => {
            updateNavbarAuth(); // Unified logic from main page
            
            const loader = document.getElementById('loader');
            if (loader) {
                setTimeout(() => {
                    loader.style.opacity = '0';
                    setTimeout(() => loader.style.display = 'none', 700);
                    document.body.classList.remove('preload');
                }, 1000);
            }

            // Set earliest booking date to today
            const datePicker = document.getElementById('bookDate');
            if (datePicker) {
                datePicker.min = new Date().toISOString().split('T')[0];
            }

            // Check login status for redirection
            if (!localStorage.getItem('userId')) {
                showModal("PLEASE LOGIN", "Please log in to continue. We are sending you to the login page...", true);
                const actionBtn = document.getElementById('modalActionButton');
                if (actionBtn) actionBtn.classList.add('hidden');
                setTimeout(() => { window.location.href = "/login"; }, 1500);
            }
        });

        // ============= 02: UNIFIED AUTHENTICATION LOGIC =============
        function updateNavbarAuth() {
            const desktopAuth = document.getElementById('nav-auth-section'); 
            const mobileDropdownAuth = document.getElementById('mobile-profile-options'); 
            const sidebarAuth = document.getElementById('sidebar-auth-section'); 
            const userId = localStorage.getItem('userId');

            const dropdownMenuHTML = `
                <a href="/profile" class="flex items-center gap-3 px-6 py-4 text-[10px] font-bold uppercase tracking-widest text-white hover:bg-accent hover:text-black transition-all">
                    <i class="fas fa-user text-[8px]"></i> My Profile
                </a>
                <button onclick="handleLogout()" class="w-full flex items-center gap-3 px-6 py-4 text-[10px] font-bold uppercase tracking-widest text-white/40 hover:text-red-500 hover:bg-white/5 transition-all border-t border-white/5">
                    <i class="fas fa-sign-out-alt text-[8px]"></i> Logout
                </button>
            `;

            const profileIconTriggerHTML = `
                <div class="relative group cursor-pointer py-2">
                    <div class="w-10 h-10 rounded-full border border-accent/30 flex items-center justify-center bg-accent/5 text-accent hover:border-accent transition-all">
                        <i class="fas fa-user-circle text-xl"></i>
                    </div>
                    <div class="hidden lg:block absolute top-full right-0 mt-2 w-48 bg-card border border-white/10 rounded-2xl shadow-2xl overflow-hidden opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform origin-top-right z-[150]">
                        ${dropdownMenuHTML}
                    </div>
                </div>
            `;

            if (userId) {
                if (desktopAuth) desktopAuth.innerHTML = profileIconTriggerHTML;
                if (mobileDropdownAuth) mobileDropdownAuth.innerHTML = dropdownMenuHTML;
                if (sidebarAuth) sidebarAuth.innerHTML = ''; 
            } else {
                const loginBtnHTML = `<a href="/login" class="px-8 py-3 border border-accent/30 rounded-full hover:bg-accent hover:text-black text-[10px] font-bold uppercase tracking-widest transition-all">Login</a>`;
                if (desktopAuth) desktopAuth.innerHTML = loginBtnHTML;
                if (sidebarAuth) sidebarAuth.innerHTML = `<a href="/login" class="block w-full py-4 text-center border border-accent/20 rounded-full text-accent font-black uppercase text-xs">Sign In</a>`;
            }
        }

        // ============= 03: MODAL & UI LOGIC (Fixed Progress Bar) =============
        function showLoadingModal(title, message) {
            const modal = document.getElementById('customModal');
            const card = document.getElementById('modalCard');
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalBody').innerText = message;
            document.getElementById('modalActionButton').classList.add('hidden');
            document.getElementById('modalLoader').classList.remove('hidden');
            document.getElementById('modalIconContainer').classList.add('hidden');
            document.getElementById('progressBarContainer').classList.add('hidden');
            modal.classList.remove('opacity-0', 'pointer-events-none');
            card.classList.replace('scale-90', 'scale-100');
        }

        function showSuccessModal(title, message) {
            const progressBar = document.getElementById('progressBar');
            const progressContainer = document.getElementById('progressBarContainer');
            
            document.getElementById('modalLoader').classList.add('hidden');
            document.getElementById('modalIconContainer').classList.remove('hidden');
            if (progressContainer) progressContainer.classList.remove('hidden');
            
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalBody').innerText = message;

            if (progressBar) {
                progressBar.style.transition = 'none';
                progressBar.style.width = '100%';
                progressBar.offsetHeight; // Force reflow
                setTimeout(() => {
                    progressBar.style.transition = 'width 3000ms linear';
                    progressBar.style.width = '0%';
                }, 50);
            }
            modalTimer = setTimeout(closeModal, 3000);
        }

        function showModal(title, message, isError = false) {
            const modal = document.getElementById('customModal');
            const card = document.getElementById('modalCard');
            const titleEl = document.getElementById('modalTitle');
            const progressBar = document.getElementById('progressBar');
            const progressContainer = document.getElementById('progressBarContainer');

            titleEl.innerText = title;
            document.getElementById('modalBody').innerText = message;
            
            if (progressContainer) progressContainer.classList.remove('hidden');
            if (progressBar) {
                progressBar.style.transition = 'none';
                progressBar.style.width = '100%';
            }

            if (isError) titleEl.classList.add('text-red-500');
            else titleEl.classList.remove('text-red-500');

            modal.classList.remove('opacity-0', 'pointer-events-none');
            card.classList.replace('scale-90', 'scale-100');

            setTimeout(() => {
                if (progressBar) {
                    progressBar.style.transition = 'width 3000ms linear';
                    progressBar.style.width = '0%';
                }
            }, 100);

            if (!isError) modalTimer = setTimeout(closeModal, 3000);
        }

        function closeModal() {
            const modal = document.getElementById('customModal');
            const card = document.getElementById('modalCard');
            const title = document.getElementById('modalTitle').innerText;
            modal.classList.add('opacity-0', 'pointer-events-none');
            card.classList.replace('scale-100', 'scale-90');
            if (typeof modalTimer !== 'undefined') clearTimeout(modalTimer);
            setTimeout(() => {
                if (title === "PLEASE LOGIN") window.location.href = "/login";
                else if (title === "Booking Confirmed") window.location.href = "/home";
            }, 500);
        }

        // ============= 04: FORM & INTERACTION =============
        const appForm = document.getElementById('appointmentForm');
        if (appForm) {
            appForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const userId = localStorage.getItem('userId');
                if (!userId) {
                    showModal("PLEASE LOGIN", "Please log in so we can save your spot.", true);
                    return;
                }
                showLoadingModal("ALMOST THERE", "We're saving your details and letting Coach Archana know.");
                const formData = new FormData(this);
                const payload = Object.fromEntries(formData.entries());
                payload.userId = userId;

                try {
                    const response = await fetch(`${API_URL}/api/booking/book`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (response.ok) showSuccessModal("Booking Confirmed", "Your spot is saved! Check your email.");
                    else showModal("OOPS!", "We couldn't save your booking right now.", true);
                } catch (err) {
                    showModal("CONNECTION ISSUE", "Please check your internet.", true);
                }
            });
        }

        // ============= 05: GLOBAL UI LOGIC =============
        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            const hamburger = document.getElementById('hamburger');
            const backdrop = document.getElementById('menuBackdrop');
            if (!menu) return;
            const isOpen = menu.classList.contains('translate-x-0');
            if (isOpen) {
                menu.classList.replace('translate-x-0', '-translate-x-full');
                if (backdrop) backdrop.classList.add('hidden');
                if (hamburger) hamburger.classList.remove('active');
                document.body.style.overflow = '';
            } else {
                menu.classList.replace('-translate-x-full', 'translate-x-0');
                if (backdrop) backdrop.classList.remove('hidden');
                if (hamburger) hamburger.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        window.addEventListener('scroll', () => {
            const nav = document.getElementById('navbar');
            if (nav) {
                if (window.scrollY > 50) nav.classList.add('nav-scrolled');
                else nav.classList.remove('nav-scrolled');
            }

            const waBtn = document.querySelector('.whatsapp-float');
            if (waBtn) {
                if (window.scrollY > 300) {
                    waBtn.style.opacity = '1';
                    waBtn.style.pointerEvents = 'all';
                } else {
                    waBtn.style.opacity = '0';
                    waBtn.style.pointerEvents = 'none';
                }
            }
        });

        function handleLogout() {
            localStorage.removeItem('userId');
            localStorage.removeItem('userEmail');
            window.location.reload(); 
        }

        // Mobile Profile Trigger
        const profileBtn = document.getElementById('profile-icon-btn');
        const profileDropdown = document.getElementById('profile-dropdown');
        if (profileBtn) {
            profileBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                profileDropdown.classList.toggle('hidden');
            });
        }
        window.addEventListener('click', () => { if (profileDropdown) profileDropdown.classList.add('hidden'); });
    </script>
</body>
</html>